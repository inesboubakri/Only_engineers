<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projects Management | Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Styles sp√©cifiques pour la table projects */
        .users-table { 
            width: 100%; 
            border-collapse: collapse; 
            font-size: 0.9em; 
        }
        .users-table th, .users-table td { 
            padding: 12px 15px; 
            text-align: left; 
            border-bottom: 1px solid #e0e0e0; 
        }
        .users-table th { 
            position: sticky; 
            top: 0; 
            background-color: #f8f9fa; 
            font-weight: 600; 
        }
        .users-table tr:hover { 
            background-color: #f5f5f5; 
        }
        .project-icon { 
            width: 40px; 
            height: 40px; 
            border-radius: 8px; 
            object-fit: cover; 
            background-color: #e0e7ff; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            color: #4f46e5; 
            font-size: 1.2em; 
        }
        .status-badge { 
            padding: 4px 8px; 
            border-radius: 12px; 
            font-size: 0.8em; 
            font-weight: 500; 
        }
        .active-status { 
            background-color: #d1fae5; 
            color: #065f46; 
        }
        .inactive-status { 
            background-color: #fee2e2; 
            color: #b91c1c; 
        }

        /* Popup form styling */
        .popup-form {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
        }

        .popup-form form {
            background: white;
            padding: 20px;
            border-radius: 8px;
            width: 400px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .popup-form form label {
            display: block;
            margin-top: 10px;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .popup-form form input, 
        .popup-form form textarea, 
        .popup-form form select {
            width: 100%;
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }

        .form-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .form-buttons button {
            padding: 10px 20px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            font-weight: 500;
        }

        .form-buttons button[type="submit"] {
            background-color: #4f46e5;
            color: white;
        }

        .form-buttons button[type="button"] {
            background-color: #9ca3af;
            color: white;
        }

        /* Message styling */
        .message {
            padding: 10px 15px;
            margin-bottom: 15px;
            border-radius: 5px;
        }

        .success {
            background-color: #d1fae5;
            color: #065f46;
            border: 1px solid #34d399;
        }

        .error {
            background-color: #fee2e2;
            color: #b91c1c;
            border: 1px solid #f87171;
        }
        #matchResults {
  margin-top: 20px;
  padding: 15px;
  background-color: #f0f4f8;
  border: 1px solid #ccc;
  border-radius: 8px;
  font-family: Arial, sans-serif;
}

#matchResults h3 {
  margin-bottom: 10px;
  font-size: 18px;
  color: #333;
}

#matchResults ul {
  list-style-type: none;
  padding: 0;
  margin: 0;
}

#matchResults li {
  padding: 8px 10px;
  background-color: #ffffff;
  border: 1px solid #ddd;
  border-radius: 5px;
  margin-bottom: 8px;
  transition: background-color 0.2s;
}

#matchResults li:hover {
  background-color: #e6f0ff;
}

    </style>
</head>
<body class="light-theme">
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <div class="logo-icon">W</div>
                <span>Wallet</span>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li><div class="nav-icon">üìä</div><span>Dashboard</span></li>
                    <li><div class="nav-icon">üë•</div><span>Users</span></li>
                    <li><div class="nav-icon">üë©üèª‚Äçüíª</div><span>Jobs</span></li>
                    <li class="active"><div class="nav-icon">üöÄ</div><span>Projects</span></li>
                    <li><div class="nav-icon">üì∞</div><span>News</span></li>
                    <li><div class="nav-icon">üèÜ</div><span>Hackathons</span></li>
                    <li><div class="nav-icon">üìö</div><span>Courses</span></li>
                    <li><div class="nav-icon">üíº</div><span>Opportunities</span></li>
                    <li><div class="nav-icon">üîî</div><span>Notifications</span><div class="notification-badge">1</div></li>
                    <li><div class="nav-icon">üö™</div><span>Sign out</span></li>
                </ul>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <h1>Hello, Ines welcome back <span class="wave-emoji">üëã</span></h1>
                <div class="header-right">
                    <div class="search-box">
                        <input type="text" placeholder="search">
                        <div class="search-icon">üîç</div>
                    </div>
                    <div class="header-theme-toggle">
                        <label class="theme-switch">
                            <input type="checkbox" id="theme-toggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="user-profile">
                        <div class="avatar">
                            <img src="https://i.pravatar.cc/100?img=32" alt="Ines Boubakri">
                        </div>
                        <span>Ines Boubakri</span>
                    </div>
                </div>
            </div>

            <!-- Projects Content -->
            <div class="users-view">
                <!-- Top Cards Row -->
                <div class="users-top-cards">
                    <div class="service-card report-card">
                        <div class="service-icon blue">
                            <span>üìã</span>
                        </div>
                        <div class="service-title">Projects Report</div>
                        <div class="service-description">Generate comprehensive reports about projects</div>
                        <button class="service-button">Generate Report</button>
                    </div>
                    <div class="service-card stats-card">
                        <div class="service-icon purple">
                            <span>üöÄ</span>
                        </div>
                        <div class="service-title">Active Projects</div>
                        <div class="service-amount">24</div>
                        <div class="service-change positive">+8.3%</div>
                    </div>
                    <div class="service-card contributors-card">
                        <div class="service-icon teal">
                            <span>üë•</span>
                        </div>
                        <div class="service-title">Total Contributors</div>
                        <div class="service-amount">187</div>
                        <div class="service-change positive">+15.2%</div>
                    </div>
                </div>

<!-- Projects Table Section -->
<div class="search-section">
    <input type="text" id="searchInput" placeholder="Search by ID" />
    <button id="searchButton" onclick="searchProjects()">Search</button>
</div>

<div class="card users-table-card">
    <div class="table-filters">
        <div class="filter-options">
            <button class="filter-btn active">All</button>
            <button class="filter-btn">Web</button>
            <button class="filter-btn">Mobile</button>
            <button class="filter-btn">AI</button>
            <button class="filter-btn">Data</button>
            <button id="downloadPdfButton" class="filter-btn" onclick="generatePDF()">Download PDF</button>
            <button id="sortByStatusButton" class="filter-btn" onclick="sortProjects()">Sort by Status</button>
            <button onclick="showStats()" class="filter-btn">Show Skill Statistics</button>
            <button onclick="sendDynamicSMS()" class="filter-btn">Send SMS</button>
<!-- ‚úÖ SMS Button Here -->

        </div>
    </div>

    <!-- Add Project button aligned to the right -->
    <div class="table-actions" style="display: flex; justify-content: flex-end;">
        <button class="add-button" id="viewRequestsButton" style="margin-right: 10px;">
            <span class="add-icon">üëÅÔ∏è</span>
            <span>View Requests</span>
        </button>
        <button class="add-button" id="addProjectButton">
            <span class="add-icon">+</span>
            <span>Add Project</span>
        </button>
    </div>
</div>

<div id="stat-container" style="display:none; text-align:center; margin-top:30px;">
    <canvas id="skillChart" style="max-width:700px;"></canvas>
</div>
  
                    <!-- Projects Table -->
                    <div class="table-container">
                        <table class="users-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Project</th>
                                    <th>Description</th>
                                    <th>Type</th>
                                    <th>Skills Required</th>
                                    <th>Git Link</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="projectsTableBody">
                                <!-- Project data will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="matchResults" style="display: none;"></div>

 <!-- Add Project Form (Popup) -->
<!-- Add Project Form (Popup) -->
<div id="addProjectForm" class="popup-form">
    <form action="../controller/add_project.php" method="POST">
        <h2>Add New Project</h2>

        <!-- Hidden field for project ID (needed for editing/updating) -->
        <input type="hidden" id="project_id" name="id">

        <label for="project">Project Name:</label>
        <input type="text" id="project" name="project" required>

        <label for="description">Description:</label>
        <textarea id="description" name="description" required></textarea>

        <label for="type">Type:</label>
        <select id="type" name="type" required>
            <option value="Web Development">Web Development</option>
            <option value="Mobile Development">Mobile Development</option>
            <option value="AI/ML">AI/ML</option>
            <option value="Data Science">Data Science</option>
            <option value="Blockchain">Blockchain</option>
        </select>

        <label for="skills_required">Skills Required:</label>
        <input type="text" id="skills_required" name="skills_required" required>

        <label for="git_link">GitHub Link:</label>
        <input type="url" id="git_link" name="git_link" required>

        <label for="status">Status:</label>
        <select id="status" name="status" required>
            <option value="active">Active</option>
            <option value="inactive">Inactive</option>
        </select>

        <div class="form-buttons">
            <button type="submit">Add Project</button>
            <button type="button" onclick="closeForm()">Cancel</button>
        </div>
    </form>
</div>

<!-- Edit Project Form (Popup) -->
<div id="editProjectForm" class="popup-form">
    <form action="../controller/update_project.php" method="POST">
        <h2>Edit Project</h2>

        <!-- Hidden field for project ID -->
        <input type="hidden" id="edit_id" name="id">

        <label for="edit_project">Project Name:</label>
        <input type="text" id="edit_project" name="project" required>

        <label for="edit_description">Description:</label>
        <textarea id="edit_description" name="description" required></textarea>

        <label for="edit_type">Type:</label>
        <select id="edit_type" name="type" required>
            <option value="Web Development">Web Development</option>
            <option value="Mobile Development">Mobile Development</option>
            <option value="AI/ML">AI/ML</option>
            <option value="Data Science">Data Science</option>
            <option value="Blockchain">Blockchain</option>
        </select>

        <label for="edit_skills_required">Skills Required:</label>
        <input type="text" id="edit_skills_required" name="skills_required" required>

        <label for="edit_git_link">GitHub Link:</label>
        <input type="url" id="edit_git_link" name="git_link" required>

        <label for="edit_status">Status:</label>
        <select id="edit_status" name="status" required>
            <option value="active">Active</option>
            <option value="inactive">Inactive</option>
        </select>

        <div class="form-buttons">
            <button type="submit">Update Project</button>
            <button type="button" onclick="closeEditForm()">Cancel</button>
        </div>
    </form>
</div>

<!-- Project Requests Modal -->
<div id="projectRequestsModal" class="popup-form">
    <div style="background: white; padding: 20px; border-radius: 8px; width: 800px; max-height: 90vh; overflow-y: auto;">
        <h2>Project Requests</h2>
        <div id="projectRequestsContainer">
            <table class="users-table" style="width: 100%;">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Project</th>
                        <th>Description</th>
                        <th>Type</th>
                        <th>Skills Required</th>
                        <th>Git Link</th>
                        <th>Request Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="requestsTableBody">
                    <!-- Project requests will be loaded here -->
                </tbody>
            </table>
        </div>
        <div style="margin-top: 20px; text-align: right;">
            <button type="button" class="form-buttons" onclick="closeRequestsModal()">Close</button>
        </div>
    </div>
</div>

<!-- JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // Open the Add Project Form popup
    document.getElementById('addProjectButton').onclick = function() {
        document.getElementById('project').value = '';
        document.getElementById('description').value = '';
        document.getElementById('type').selectedIndex = 0;
        document.getElementById('skills_required').value = '';
        document.getElementById('git_link').value = '';
        document.getElementById('status').selectedIndex = 0;
        document.getElementById('addProjectForm').style.display = 'flex';
    };

    function closeForm() {
        document.getElementById('addProjectForm').style.display = 'none';
    }

    function openEditForm(id, project, description, type, skills, git, status) {
        document.getElementById('edit_id').value = id; // Set the ID for the project
        document.getElementById('edit_project').value = decodeURIComponent(project);
        document.getElementById('edit_description').value = decodeURIComponent(description);
        document.getElementById('edit_type').value = type;
        document.getElementById('edit_skills_required').value = decodeURIComponent(skills);
        document.getElementById('edit_git_link').value = git;
        document.getElementById('edit_status').value = status;
        document.getElementById('editProjectForm').style.display = 'flex';
    }

    function closeEditForm() {
        document.getElementById('editProjectForm').style.display = 'none';
    }

    function deleteProject(id) {
        if (confirm('Are you sure you want to delete this project?')) {
            window.location.href = '../controller/delete_project.php?id=' + id;
        }
    }

    document.addEventListener("DOMContentLoaded", function() {
    loadProjects();
});

document.addEventListener("DOMContentLoaded", function() {
    loadProjects();
});

let allProjects = []; // Store all projects globally

function loadProjects() {
    const xhr = new XMLHttpRequest();
    xhr.open("GET", "../controller/get_projects.php", true);

    xhr.onload = function() {
        if (this.status === 200) {
            try {
                const projects = JSON.parse(this.responseText);
                allProjects = projects; // Save all projects for later use
                handlePendingProjects(projects);
            } catch (e) {
                console.error("Error parsing JSON:", e);
                document.getElementById("projectsTableBody").innerHTML = 
                    "<tr><td colspan='8' style='text-align: center;'>Error loading projects</td></tr>";
            }
        } else {
            document.getElementById("projectsTableBody").innerHTML = 
                "<tr><td colspan='8' style='text-align: center;'>Error: " + this.status + "</td></tr>";
        }
    };

    xhr.onerror = function() {
        document.getElementById("projectsTableBody").innerHTML = 
            "<tr><td colspan='8' style='text-align: center;'>Network error occurred</td></tr>";
    };

    xhr.send();
}

function handlePendingProjects(projects) {
    const pending = projects.filter(p => p.status === 'pending');

    if (pending.length > 0) {
        // Only handle one pending project at a time
        const project = pending[0];

        const decision = confirm(`Project "${project.project}" is pending.\nDo you want to accept it?`);
        const newStatus = decision ? 'active' : 'rejected';

        updateProjectStatus(project.id, newStatus);
    } else {
        // If no pending projects, display normally
        displayProjects(projects.filter(p => p.status !== 'rejected')); // Optional: hide rejected if you want
    }
}

function sendDynamicSMS() {
    const phone = '+1234567890';
    const projectName = 'AI Chatbot';
    const status = 'In Progress';
    
    const message = encodeURIComponent(`Project: ${projectName}, Status: ${status}`);
    window.location.href = `sms:${phone}?body=${message}`;
  }

function updateProjectStatus(projectId, newStatus) {
    const xhr = new XMLHttpRequest();
    xhr.open("POST", "../controller/update_project_status.php", true);
    xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

    xhr.onload = function() {
        if (this.status === 200) {
            try {
                const response = JSON.parse(this.responseText);
                if (response.success) {
                    loadProjects(); // After updating, reload the projects list
                } else {
                    alert("Failed to update project status.");
                }
            } catch (e) {
                console.error("Error parsing update response:", e);
            }
        } else {
            console.error("Error updating status: " + this.status);
        }
    };

    xhr.send(`id=${projectId}&status=${newStatus}`);
}

function displayProjects(projects) {
    const tableBody = document.getElementById("projectsTableBody");

    if (projects.length === 0) {
        tableBody.innerHTML = "<tr><td colspan='8' style='text-align: center;'>No projects found</td></tr>";
        return;
    }

    let html = "";

    projects.forEach(function(project) {
        html += `
            <tr>
                <td>${project.id}</td>
                <td><div class="project-icon">${project.project.charAt(0)}</div> ${project.project}</td>
                <td>${project.description}</td>
                <td>${project.type}</td>
                <td>${project.skills_required}</td>
                <td><a href="${project.git_link}" target="_blank">View on GitHub</a></td>
                <td><span class="status-badge ${project.status === 'active' ? 'active-status' : 'inactive-status'}">
                    ${project.status.charAt(0).toUpperCase() + project.status.slice(1)}
                </span></td>
                <td>
                    <button class="edit-btn" onclick="openEditForm(${project.id}, '${encodeURIComponent(project.project)}', '${encodeURIComponent(project.description)}', '${project.type}', '${encodeURIComponent(project.skills_required)}', '${project.git_link}', '${project.status}')">Edit</button>
                    <button class="delete-btn" onclick="deleteProject(${project.id})">Delete</button>
     <button class="match-btn" onclick="matchUsers('${project.skills_required}')">Match</button>

                </td>
            </tr>
        `;
    });

    tableBody.innerHTML = html;
}


function matchUsers(skillsRequired) {
  fetch(`match.php?skills_required=${encodeURIComponent(skillsRequired)}`)
    .then(response => response.json())
    .then(users => {
      const container = document.getElementById("matchResults");
      container.innerHTML = "";

      if (users.length === 0) {
        container.innerHTML = "<p>Aucun utilisateur correspondant trouv√©.</p>";
      } else {
        let list = "<h3>Utilisateurs correspondants :</h3><ul>";
        users.forEach(user => {
          list += `<li><strong>${user.full_name}</strong> ‚Äî ${user.skills}</li>`;
        });
        list += "</ul>";
        container.innerHTML = list;
      }

      container.style.display = "block";
    })
    .catch(error => {
      console.error("Erreur :", error);
      alert("Erreur lors de la r√©cup√©ration des correspondances.");
    });
}







function searchProjects() {
    const searchInput = document.getElementById("searchInput").value.toLowerCase();
    const filteredProjects = allProjects.filter(project => project.id.toString().includes(searchInput));

    displayProjects(filteredProjects); // Update table with filtered results
}
function sortProjects() {
    // Sort the projects by status: "active" should come first
    const sortedProjects = allProjects.sort((a, b) => {
        // If both statuses are the same, return 0 to keep the order
        if (a.status === b.status) return 0;

        // "active" projects come before "inactive"
        if (a.status === "active") return -1;
        if (b.status === "active") return 1;

        // Otherwise, "inactive" comes after "active"
        return 0;
    });

    // Call displayProjects with the sorted data
    displayProjects(sortedProjects);
}

function generatePDF() {
    const { jsPDF } = window.jspdf;

    // Get the table content (the whole table with the header and body)
    const tableContent = document.querySelector('.users-table');

    // Create a new jsPDF instance
    const doc = new jsPDF();

    // Use html2pdf to capture the table and generate the PDF
    html2pdf().from(tableContent).save('projects_table.pdf');
}
function showStats() {
        const skillsCount = {}; // Object to store the count of each skill

        allProjects.forEach(project => {
            const skills = project.skills_required.split(','); // Assuming skills are comma separated
            skills.forEach(skill => {
                skill = skill.trim();
                skillsCount[skill] = (skillsCount[skill] || 0) + 1;
            });
        });

        const skillNames = Object.keys(skillsCount);
        const skillValues = Object.values(skillsCount);

        const ctx = document.getElementById('skillChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: skillNames,
                datasets: [{
                    label: 'Skills Required',
                    data: skillValues,
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        document.getElementById('stat-container').style.display = 'block';
    }


    // Add validation for the Add Project form
    document.querySelector('#addProjectForm form').onsubmit = function (event) {
        const project = document.getElementById('project').value.trim();
        const description = document.getElementById('description').value.trim();
        const type = document.getElementById('type').value;
        const skillsRequired = document.getElementById('skills_required').value.trim();
        const gitLink = document.getElementById('git_link').value.trim();
        const status = document.getElementById('status').value;

        let errors = [];

        // Validate Project Name
        if (!project) {
            errors.push('Project name is required.');
        } else if (project.length < 3 || project.length > 50) {
            errors.push('Project name must be between 3 and 50 characters.');
        }

        // Validate Description
        if (!description) {
            errors.push('Description is required.');
        } else if (description.length < 10) {
            errors.push('Description must be at least 10 characters long.');
        }

        // Validate Type
        const validTypes = ['Web Development', 'Mobile Development', 'AI/ML', 'Data Science', 'Blockchain'];
        if (!validTypes.includes(type)) {
            errors.push('Invalid project type selected.');
        }

        // Validate Skills Required
        if (!skillsRequired) {
            errors.push('Skills required field cannot be empty.');
        }

        // Validate GitHub Link
        if (!gitLink) {
            errors.push('GitHub link is required.');
        } else if (!isValidURL(gitLink)) {
            errors.push('Invalid GitHub link format.');
        }

        // Validate Status
        const validStatuses = ['active', 'inactive'];
        if (!validStatuses.includes(status)) {
            errors.push('Invalid status selected.');
        }

        // If there are errors, prevent form submission and display errors
        if (errors.length > 0) {
            alert(errors.join('\n'));
            event.preventDefault();
        }
    };
    // Add validation for the Edit Project form
document.querySelector('#editProjectForm form').onsubmit = function (event) {
    const project = document.getElementById('edit_project').value.trim();
    const description = document.getElementById('edit_description').value.trim();
    const type = document.getElementById('edit_type').value;
    const skillsRequired = document.getElementById('edit_skills_required').value.trim();
    const gitLink = document.getElementById('edit_git_link').value.trim();
    const status = document.getElementById('edit_status').value;

    let errors = [];

    // Validate Project Name
    if (!project) {
        errors.push('Project name is required.');
    } else if (project.length < 3 || project.length > 50) {
        errors.push('Project name must be between 3 and 50 characters.');
    }

    // Validate Description
    if (!description) {
        errors.push('Description is required.');
    } else if (description.length < 10) {
        errors.push('Description must be at least 10 characters long.');
    }

    // Validate Type
    const validTypes = ['Web Development', 'Mobile Development', 'AI/ML', 'Data Science', 'Blockchain'];
    if (!validTypes.includes(type)) {
        errors.push('Invalid project type selected.');
    }

    // Validate Skills Required
    if (!skillsRequired) {
        errors.push('Skills required field cannot be empty.');
    }

    // Validate GitHub Link
    if (!gitLink) {
        errors.push('GitHub link is required.');
    } else if (!isValidURL(gitLink)) {
        errors.push('Invalid GitHub link.');
    }

    // Validate Status
    if (!['active', 'inactive'].includes(status)) {
        errors.push('Invalid project status.');
    }

    if (errors.length > 0) {
        event.preventDefault();  // Prevent form submission
        alert(errors.join("\n"));
    }
};


    // Helper function to validate URLs
    function isValidURL(string) {
        try {
            new URL(string);
            return true;
        } catch (_) {
            return false;
        }
    }

// View Requests button event handler
    document.getElementById('viewRequestsButton').onclick = function() {
        loadProjectRequests();
        document.getElementById('projectRequestsModal').style.display = 'flex';
    };

    function closeRequestsModal() {
        document.getElementById('projectRequestsModal').style.display = 'none';
    }

    // Load project requests
    function loadProjectRequests() {
        const xhr = new XMLHttpRequest();
        xhr.open("GET", "../controller/get_project_requests.php", true);

        xhr.onload = function() {
            if (this.status === 200) {
                try {
                    const requests = JSON.parse(this.responseText);
                    displayProjectRequests(requests);
                } catch (e) {
                    console.error("Error parsing JSON:", e);
                    document.getElementById("requestsTableBody").innerHTML = 
                        "<tr><td colspan='8' style='text-align: center;'>Error loading project requests</td></tr>";
                }
            } else {
                document.getElementById("requestsTableBody").innerHTML = 
                    "<tr><td colspan='8' style='text-align: center;'>Error: " + this.status + "</td></tr>";
            }
        };

        xhr.onerror = function() {
            document.getElementById("requestsTableBody").innerHTML = 
                "<tr><td colspan='8' style='text-align: center;'>Network error occurred</td></tr>";
        };

        xhr.send();
    }

    // Display project requests in the modal
    function displayProjectRequests(requests) {
        const tableBody = document.getElementById("requestsTableBody");

        if (!requests || requests.length === 0) {
            tableBody.innerHTML = "<tr><td colspan='8' style='text-align: center;'>No project requests found</td></tr>";
            return;
        }

        let html = "";

        requests.forEach(function(request) {
            html += `
                <tr>
                    <td>${request.id}</td>
                    <td><div class="project-icon">${request.project.charAt(0)}</div> ${request.project}</td>
                    <td>${request.description}</td>
                    <td>${request.type}</td>
                    <td>${request.skills_required}</td>
                    <td><a href="${request.git_link}" target="_blank">View on GitHub</a></td>
                    <td>${new Date(request.request_date).toLocaleDateString()}</td>
                    <td>
                        <button class="edit-btn" onclick="approveRequest(${request.id})">Approve</button>
                        <button class="delete-btn" onclick="rejectRequest(${request.id})">Reject</button>
                    </td>
                </tr>
            `;
        });

        tableBody.innerHTML = html;
    }

    // Approve a project request
    function approveRequest(requestId) {
        if (confirm('Are you sure you want to approve this project request?')) {
            const xhr = new XMLHttpRequest();
            xhr.open("POST", "../controller/process_project_request.php", true);
            xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

            xhr.onload = function() {
                if (this.status === 200) {
                    try {
                        const response = JSON.parse(this.responseText);
                        if (response.success) {
                            alert('Project request approved successfully!');
                            loadProjectRequests(); // Reload the requests
                        } else {
                            alert('Error: ' + response.message);
                        }
                    } catch (e) {
                        console.error("Error parsing response:", e);
                        alert('An error occurred while processing the request.');
                    }
                } else {
                    alert('Error: ' + this.status);
                }
            };

            xhr.send(`id=${requestId}&action=approve`);
        }
    }

    // Reject a project request
    function rejectRequest(requestId) {
        if (confirm('Are you sure you want to reject this project request?')) {
            const xhr = new XMLHttpRequest();
            xhr.open("POST", "../controller/process_project_request.php", true);
            xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

            xhr.onload = function() {
                if (this.status === 200) {
                    try {
                        const response = JSON.parse(this.responseText);
                        if (response.success) {
                            alert('Project request rejected!');
                            loadProjectRequests(); // Reload the requests
                        } else {
                            alert('Error: ' + response.message);
                        }
                    } catch (e) {
                        console.error("Error parsing response:", e);
                        alert('An error occurred while processing the request.');
                    }
                } else {
                    alert('Error: ' + this.status);
                }
            };

            xhr.send(`id=${requestId}&action=reject`);
        }
    }
</script>
<!-- jsPDF Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<!-- html2pdf.js Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.js"></script>

</body>
</html>
